" Install pathogen
call pathogen#infect()

map <Leader><Leader>[ :bp<CR>
map <Leader><Leader>] :bn<CR>

nnoremap ,t :CtrlP<CR>
nnoremap ,b :CtrlPBuffer<CR>
nnoremap ,f :CtrlPMRUFiles<CR>

map ,s :OpenVertical(alternate#FindAlternate())<CR>
map ,a :Open(alternate#FindAlternate())<CR>
map ,q :bn<CR>
map ,z :RV<CR>

map <Leader>r :e %:p:h<CR>
nmap ,r :e %:p:h<CR>

" make :W to :w 
cnoreabbrev W w

autocmd FileType ruby nnoremap <buffer> rr :execute "! rspec " . alternate#FindTest() <CR>
autocmd FileType coffee nnoremap <buffer> rr :execute "! jest " . alternate#FindTest() <CR>
autocmd FileType javascript nnoremap <buffer> rr :execute "! jest " . alternate#FindTest() <CR>
autocmd FileType cucumber noremap <buffer> rr :!cucumber %<CR>
autocmd FileType python nnoremap <buffer> rr :execute "! nosetests " . alternate#FindTest() <CR>

map ,1 :!!!<CR>

" Turn on filetype and indentation rules on
filetype indent on
filetype plugin on

" General settings
set title
set encoding=utf-8

set autoindent
set expandtab
set tabstop=2
set softtabstop=2
set shiftwidth=2

set hidden " Not sure what this does...

" Fix the backspace key
set backspace=indent,eol,start

" Disable backups
set nobackup
set nowritebackup
set noswapfile

" Ignores Gone Wild!
set wildignore+=*/.sass-cache/*
set wildignore+=*.png,*.gif,*.jpg,*.ico,*.pdf,*.DS_Store

" CTRLP stuffs
let g:ctrlp_match_window_reversed = 0
let g:ctrlp_clear_cache_on_exit = 0 " Cross session caching
let g:ctrlp_max_height = 20
let g:ctrlp_use_caching = 1 " Disable caching
let g:ctrlp_custom_ignore = {
  \ 'dir':  'coverage\|tmp\|log\|solr\|node_modules\|.git',
  \ 'file': '\.exe$\|\.so$\|\.dll$|\.gif$\|\.png$\|\.jpg$|\.ico$|\.ttf$|\.EOT$|\.ico$\|\.DS_Store$',
  \ }

" Quicky exit edit mode with jj
imap kj <Esc>:w<CR>
imap kk <Esc>:wq<CR>

" Searching
set hlsearch
set incsearch
set ignorecase
set smartcase

" Move between windows
nnoremap <C-h> <C-w>h
nnoremap <C-j> <C-w>j
nnoremap <C-k> <C-w>k
nnoremap <C-l> <C-w>l

" http://vim.wikia.com/wiki/Easy_edit_of_files_in_the_same_directory
" Easy edit files in same directory
" e %%/new_file.txt
cabbr <expr> %% expand('%:p:h')

" automatically reload vimrc when it's saved
au BufWritePost .vimrc so ~/.vimrc

" Viewing
set number
set ruler
set nocursorline
set nowrap
set list listchars=tab:\ \ ,trail:Â·
set nofoldenable
set ruler
set showcmd
set laststatus=2
syntax enable

colorscheme jellybeans

" Allow gist.vim to copy shit into the clipboard
let g:gist_clip_command = 'pbcopy'

" use ,F to jump to tag in a vertical split
nnoremap <silent> ,F :let word=expand("<cword>")<CR>:vsp<CR>:wincmd w<cr>:exec("tag ". word)<cr>

" use ,gf to go to file in a vertical split
nnoremap <silent> ,gf :vertical botright wincmd f<CR>

" Per project .vimrc files baby...
set exrc " enable per-directory .vimrc files
set secure " disable unsafe commands in local .vimrc files
